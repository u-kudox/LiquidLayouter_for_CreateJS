/*
LiquidLayouter for CreateJS
Version: 1.10
Author: kudox
http://kudox.jp/
http://twitter.com/u_kudox
Licensed under the MIT License
Copyright (c) 2012 kudox.jp
*/
this.createjs=this.createjs||{};(function(k){"use strict";var m=0.5;var n=false;var o;var q=false;var r=false;var s;var t;var u;var v;var w;var z=[];function LiquidLayouter(){if(!n){throw new Error("LiquidLayouter is Singleton Class. Please call 'LiquidLayouter.getInstance()'.");}n=false}LiquidLayouter.VERSION="1.1.0";LiquidLayouter.getInstance=function(){if(o){return o}n=true;o=new LiquidLayouter();return o};var p=LiquidLayouter.prototype={get initialized(){return q},get stage(){return t},get canvas(){return s},get stageWidth(){return s.width},get stageHeight(){return s.height},get drawingAreaRect(){return w}};p.getInitialized=function(){return q};p.getStage=function(){return t};p.getCanvas=function(){return s};p.getStageWidth=function(){return s.width};p.getStageHeight=function(){return s.height};p.getDrawingAreaRect=function(){return w};p.align="";p.minWidth=0;p.minHeight=0;p.maxWidth=0;p.maxHeight=0;p.fixedWidth=false;p.fixedHeight=false;p.tweenEnabled=false;p.tweenTime=1000;p.tweenEase;p.initialize=function(a,b,c,d,e,f){if(q){throw new Error("LiquidLayouter has already been initialized.");return}if(!(a instanceof createjs.Stage)){throw new Error(a+" is not createjs.Stage instance.");}q=true;t=a;s=a.canvas;u=s.width;v=s.height;this.align=b||"";this.minWidth=c||0;this.minHeight=d||0;this.maxWidth=e||0;this.maxHeight=f||0;if("onorientationchange"in k){r=true;if(createjs.Tween){this.tweenEnabled=true;if(!this.tweenEase){this.tweenEase=createjs.Ease.quintOut}}}this.addResizeListener();updateCanvasSize();updateDrawingAreaRect()};p.addLayoutObject=function(a,b,x,y,c,d,e,f){if(!q){throw new Error("LiquidLayouter instance has not been initialized.");}if(!(a instanceof createjs.DisplayObject)){throw new Error(a+" does not inherit from createjs.DisplayObject.");}var g=getIndexOfObject(z,a);if(g!==-1){throw new Error("LiquidLayouter has the object already.");}b=b||"";if(typeof x==="string"){if(isNaN(Number(x))){throw new Error('"'+x+'"'+" can not be converted to a number.");}}else if(isNaN(x)){x=this.getRelativeX(b,a.x)}if(typeof y==="string"){if(isNaN(Number(y))){throw new Error('"'+y+'"'+" can not be converted to a number.");}}else if(isNaN(y)){y=this.getRelativeY(b,a.y)}c=c||false;d=d||SizeFollowRule.NONE;e=e||a.scaleX;f=f||a.scaleY;z.push(new LayoutObject(a,b,x,y,c,d,e,f))};p.getLayoutObject=function(a){var b=getIndexOfObject(z,a);if(b!==-1){return z[b]}else{return null}};p.removeLayoutObject=function(a){var b=getIndexOfObject(z,a);if(b!==-1){z.splice(b,1)}};p.getRelativeX=function(a,x){switch(a){case StageAlign.TOP_LEFT:case StageAlign.LEFT:case StageAlign.BOTTOM_LEFT:break;case StageAlign.TOP_RIGHT:case StageAlign.RIGHT:case StageAlign.BOTTOM_RIGHT:x=x-u;break;case StageAlign.TOP:case StageAlign.BOTTOM:default:x=x-u*m;break}return x};p.getRelativeY=function(a,y){switch(a){case StageAlign.TOP:case StageAlign.TOP_LEFT:case StageAlign.TOP_RIGHT:break;case StageAlign.BOTTOM:case StageAlign.BOTTOM_LEFT:case StageAlign.BOTTOM_RIGHT:y=y-v;break;case StageAlign.LEFT:case StageAlign.RIGHT:default:y=y-v*m;break}return y};p.getAlignPoint=function(a){var b=w;var x=0;var y=0;switch(a){case StageAlign.TOP:x=b.width*m+b.x;y=b.y;break;case StageAlign.TOP_LEFT:x=b.x;y=b.y;break;case StageAlign.TOP_RIGHT:x=b.width+b.x;y=b.y;break;case StageAlign.LEFT:x=b.x;y=b.height*m+b.y;break;case StageAlign.RIGHT:x=b.width+b.x;y=b.height*m+b.y;break;case StageAlign.BOTTOM:x=b.width*m+b.x;y=b.height+b.y;break;case StageAlign.BOTTOM_LEFT:x=b.x;y=b.height+b.y;break;case StageAlign.BOTTOM_RIGHT:x=b.width+b.x;y=b.height+b.y;break;default:x=b.width*m+b.x;y=b.height*m+b.y;break}return new createjs.Point(x,y)};p.updateLayout=function(a){if(a){var b=getIndexOfObject(z,a);if(b!==-1){propertyConversion(z[b])}}else{for(var i=0,l=z.length;i<l;++i){propertyConversion(z[i])}}t.update()};p.onResize=function(e){updateCanvasSize();updateDrawingAreaRect();o.updateLayout()};p.addResizeListener=function(){k.addEventListener("resize",this.onResize,false)};p.removeResizeListener=function(){k.removeEventListener("resize",this.onResize,false)};function updateDrawingAreaRect(){var a=s.width;var b=s.height;var c=o.minWidth;var d=o.maxWidth;var e=o.minHeight;var f=o.maxHeight;var g=a;var h=b;if(0<c&&g<c){g=c}else if(0<d&&d<g){g=d}if(0<e&&h<e){h=e}else if(0<f&&f<h){h=f}var i=g-a;var j=h-b;var x=0;var y=0;switch(o.align){case StageAlign.TOP:x-=i*m;break;case StageAlign.TOP_LEFT:break;case StageAlign.TOP_RIGHT:x-=i;break;case StageAlign.LEFT:y-=j*m;break;case StageAlign.RIGHT:x-=i;y-=j*m;break;case StageAlign.BOTTOM:x-=i*m;y-=j;break;case StageAlign.BOTTOM_LEFT:y-=j;break;case StageAlign.BOTTOM_RIGHT:x-=i;y-=j;break;default:x-=i*m;y-=j*m;break}w=new createjs.Rectangle(x,y,g,h)}function propertyConversion(a){var b=a.align;var c=o.getAlignPoint(b);var d=w;var x=0;if(typeof a.x==="string"){x=d.width*Number(a.x)+d.x}else{x=c.x+a.x}var y=0;if(typeof a.y==="string"){y=d.height*Number(a.y)+d.y}else{y=c.y+a.y}if(a.rounded){switch(b){case StageAlign.TOP:x=Math.round(x);y=Math.floor(y);break;case StageAlign.TOP_LEFT:x=Math.floor(x);y=Math.floor(y);break;case StageAlign.TOP_RIGHT:x=Math.ceil(x);y=Math.floor(y);break;case StageAlign.LEFT:x=Math.floor(x);y=Math.round(y);break;case StageAlign.RIGHT:x=Math.ceil(x);y=Math.round(y);break;case StageAlign.BOTTOM:x=Math.round(x);y=Math.ceil(y);break;case StageAlign.BOTTOM_LEFT:x=Math.floor(x);y=Math.ceil(y);break;case StageAlign.BOTTOM_RIGHT:x=Math.ceil(x);y=Math.ceil(y);break;default:x=Math.round(x);y=Math.round(y);break}}var e,scaleY;if(a.sizeFollowRule!==SizeFollowRule.NONE){var f=d.width/u;var g=d.height/v;e=a.scaleX;scaleY=a.scaleY;switch(a.sizeFollowRule){case SizeFollowRule.WIDTH_FOLLOW:e*=f;scaleY*=f;break;case SizeFollowRule.HEIGHT_FOLLOW:e*=g;scaleY*=g;break;case SizeFollowRule.WIDTH_ONLY:e*=f;scaleY=NaN;break;case SizeFollowRule.HEIGHT_ONLY:e=NaN;scaleY*=g;break;case SizeFollowRule.FIT:e*=f;scaleY*=g;break;case SizeFollowRule.AUTO:default:if(g<=f){e*=f;scaleY*=f}else{e*=g;scaleY*=g}break}}var h=a.object;if(r&&o.tweenEnabled){var i={x:x,y:y};if(!isNaN(e)){i.scaleX=e}if(!isNaN(scaleY)){i.scaleY=scaleY}createjs.Tween.get(h,{override:true}).to(i,o.tweenTime,o.tweenEase)}else{h.x=x;h.y=y;if(!isNaN(e)){h.scaleX=e}if(!isNaN(scaleY)){h.scaleY=scaleY}}}function updateCanvasSize(){if(!o.fixedWidth){s.width=k.innerWidth}if(!o.fixedHeight){s.height=k.innerHeight}}function getIndexOfObject(a,b){for(var i=0,l=a.length;i<l;++i){var c=a[i];if(c.object===b){return i}}return-1}function LayoutObject(a,b,x,y,c,d,e,f){this.object=a;this.align=b;this.x=x;this.y=y;this.rounded=c;this.sizeFollowRule=d;this.scaleX=e;this.scaleY=f}function StageAlign(){throw new Error("StageAlign is a static class and can not be instantiated.");}StageAlign.BOTTOM="B";StageAlign.BOTTOM_LEFT="BL";StageAlign.BOTTOM_RIGHT="BR";StageAlign.LEFT="L";StageAlign.RIGHT="R";StageAlign.TOP="T";StageAlign.TOP_LEFT="TL";StageAlign.TOP_RIGHT="TR";function SizeFollowRule(){throw new Error("SizeFollowRule is a static class and can not be instantiated.");}SizeFollowRule.AUTO="auto";SizeFollowRule.WIDTH_FOLLOW="widthFollow";SizeFollowRule.HEIGHT_FOLLOW="heightFollow";SizeFollowRule.WIDTH_ONLY="widthOnly";SizeFollowRule.HEIGHT_ONLY="heightOnly";SizeFollowRule.FIT="fit";SizeFollowRule.NONE="none";createjs.LiquidLayouter=LiquidLayouter;createjs.StageAlign=StageAlign;createjs.SizeFollowRule=SizeFollowRule}(window));